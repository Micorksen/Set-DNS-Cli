language: c++
sudo: false

branches:
  except: /pr\/.*/
  
matrix:
  include:
    - os: windows

before_deploy:
  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then choco install zip ; fi

before_script:
  - mkdir obj
  - cd obj/ && mkdir src
  - cd src/ && mkdir headers
  - cd ../../ && ls

script:
  - g++ -Wall -fexceptions -O2 -I./src/headers -c ./src/main.cpp -o ./obj/src/main.o -m32
  - g++ -Wall -fexceptions -O2 -I./src/headers -c ./src/headers/colors.cpp -o ./obj/src/headers/colors.o -m32
  - g++ -Wall -fexceptions -O2 -I./src/headers -c ./src/headers/config_reader.cpp -o ./obj/src/headers/config_reader.o-m32
  - g++ -o ./bin/Set-DNS-CLI.exe ./obj/src/headers/colors.o ./obj/src/headers/config_reader.o ./obj/src/main.o -s -static -static-libstdc++ -statis-libgcc -m32
  - ./mt.exe -nologo -manifest ./Set-DNS-CLI.manifest -outputresource:"./bin/Set-DNS-CLI.exe";1
  - copy ./config.cfg ./bin
  - zip ./bin/Set-DNS-CLI-win.zip ./bin

branches:
  except:
    - "/^v\\d+\\.\\d+\\.\\d+$/"

deploy:
  provider: releases
  api_key:
    secure: "Ej/fJy7/GHgvNa9GCfQlk0n3o7udX7xOiHkIuku9iJFOCDfE9t+Fki4aleiCT730nCI4rvXv39+fQBKpm0Vn4RqIDRswMgoh85la8hQP4d/kvqf4+Lm6mRFyeS+kb1un6VCr+48bBjBbAw8FjNcdFBkrP8iTvQ1Tvxek1TEKolzt9r3f8eeW2E88/S4G7ttn6M1sFWxB1v2OjatbaQQLh31EbjO7fjEfcZGxdK6LXtopW36+wIrygijzDbkMXoAogyoe5J+d31lWplyv3xCzBEDKR5n81wg+JbYkERhQT4kuQc5+2n83t60FQB5CwDmkwUFT4OdowZ1sKb7EEp8t3aduFNpMsBFRxPpjb+R3RPUJHPopOXYNu415SEZ1Pi0FvpwXQsjWzX7v20igHU/MaGAIDv6ukNbk3OgSZjREcwdOb6lTqJKmDv8c0PEkZAmqArEr954oYWH44DSFD2oCvWf0JvTdBuKxqKKK48aNMbLBsSRhP3/GAU8f1eweM5AOeNclMtgdGUOSsWnBt/YiBdn17p/M1pqElixOL4+ev+kcrffcJFboRqbpF2IuO8B/FbXG/085VEJjJPa+qsBb9d4a7x5UwviW4PHcakFKbrlBq4D9m4cvFSHYXMW0U5zSoZ1t8Gf7YLiwsd3DF84Z4UAlMt0X3JVoVV8su8N0WaY="
  file: "./bin/Set-DNS-CLI-win.zip"
  skip_cleanup: true
  draft: true
